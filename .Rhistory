tau <- 0 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + rnorm(n*2, mean=0, sd=sigma_post)
cor(pre, post)
n <- 10^4
alpha_1 <- 0 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.8
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + rnorm(n*2, mean=0, sd=sigma_post)
sd(pre)
sd(post)
coef(lm(post ~ pre + treatment))
cor(pre, post)
n <- 10^4
alpha_1 <- 0 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.8
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
coef(lm(post ~ pre + treatment))
cor(pre, post)
n <- 10^4
alpha_1 <- 0 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
coef(lm(post ~ pre + treatment))
cor(pre, post)
n <- 10^4
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
n <- 10^4
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
n <- 10^4
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
n <- 10^4
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
diag(2)
R <- diag(2)
R[2,1] <- R[1, 2] <- rho
sigma <- c(sigma_pre, sigma_post)
Sigma <- diag(sigma)%*%R%*%diag(sigma)
Sigma
gtt_effects <- c(alpha_1, alpha_1 + tau)
beta <- gtt_effects*sigma + alpha_1*beta_1
alpha_1*beta_1
beta
mu <- c(10, 10)
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
library(mvtnorm)
mu <- c(10, 10)
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
fd <- data.table(treatment=treatment, each=n)
library(data.table)
mu <- c(10, 10)
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
fd <- data.table(treatment=treatment, each=n)
fd_wide <- cbind(fd, Y)
fd_wide
mu <- c(10, 10)
colnames(mu) <- c("pre", "post")
names(mu) <- c("pre", "post")
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
fd <- data.table(treatment=treatment, each=n)
fd_wide <- cbind(fd, Y)
fd_wide
coef(lm(post ~ pre + treatment))
fd <- data.table(treatment=treatment, each=n)
fd[, id:=factor(1:.N)]
fd_wide <- cbind(fd, Y)
coef(lm(post ~ pre + treatment))
fd_long <- melt(fd_wide, id.vars=c("treatment", "id"),
measure.vars = names(mu),
variable.name = "time",
value.name = "glucose")
fd_long
y_cols <- c("pre", "post")
mu <- c(10, 10)
names(mu) <- y_cols
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
fd <- data.table(treatment=treatment, each=n)
fd[, id:=factor(1:.N)]
fd_wide <- cbind(fd, Y)
coef(lm(post ~ pre + treatment))
fd_long <- melt(fd_wide, id.vars=c("treatment", "id"),
measure.vars = y_cols,
variable.name = "time",
value.name = "glucose")
fd_long[, time:=factor(time, y_cols)]
fit <- gls(glucose ~ factor(time)*treatment,
data = fd_long,
weights = varIdent(form= ~ 1 | time),
correlation= corSymm(form=~ 1| id)
)
library(nlme)
fit <- gls(glucose ~ factor(time)*treatment,
data = fd_long,
weights = varIdent(form= ~ 1 | time),
correlation= corSymm(form=~ 1| id)
)
getVarCov(fit, individual=fd_long[1,id])
Sigma_fit <- getVarCov(fit, individual=fd_long[1,id])
Rho_fit <- cov2cor(Sigma_fit)
Rho_fit
n <- 10^4
# using path model
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0.5 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
# using rmvnorm
R <- diag(2)
R[2,1] <- R[1, 2] <- rho
sigma <- c(sigma_pre, sigma_post)
Sigma <- diag(sigma)%*%R%*%diag(sigma)
beta_1 <- R_0*sigma
n <- 10^4
# using path model
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0.5 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
# using rmvnorm
R <- diag(2)
R[2,1] <- R[1, 2] <- rho
sigma <- c(sigma_pre, sigma_post)
Sigma <- diag(sigma)%*%R%*%diag(sigma)
beta <- c(0, beta_1)
gtt_effects <- c(alpha_1, alpha_1 + tau)
beta <- gtt_effects*sigma + alpha_1*beta
y_cols <- c("pre", "post")
mu <- c(10, 10)
names(mu) <- y_cols
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
fd <- data.table(treatment=treatment, each=n)
fd[, id:=factor(1:.N)]
fd_wide <- cbind(fd, Y)
coef(lm(post ~ pre + treatment))
fd_long <- melt(fd_wide, id.vars=c("treatment", "id"),
measure.vars = y_cols,
variable.name = "time",
value.name = "glucose")
fd_long[, time:=factor(time, y_cols)]
fit <- gls(glucose ~ factor(time)*treatment,
data = fd_long,
weights = varIdent(form= ~ 1 | time),
correlation= corSymm(form=~ 1| id)
)
Sigma_fit <- getVarCov(fit, individual=fd_long[1,id])
Rho_fit <- cov2cor(Sigma_fit)
Rho_fit
n <- 10^4
# using path model
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0.5 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
# using rmvnorm
R <- diag(2)
R[2,1] <- R[1, 2] <- rho
sigma <- c(sigma_pre, sigma_post)
Sigma <- diag(sigma)%*%R%*%diag(sigma)
beta <- c(0, beta_1)
gtt_effects <- c(alpha_1, alpha_1 + tau)
beta <- gtt_effects*sigma + alpha_1*beta
y_cols <- c("pre", "post")
mu <- c(10, 10)
names(mu) <- y_cols
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
fd <- data.table(treatment=treatment, each=n)
fd[, id:=factor(1:.N)]
fd_wide <- cbind(fd, Y)
coef(lm(post ~ pre + treatment, data=fd_wide))
fd_long <- melt(fd_wide, id.vars=c("treatment", "id"),
measure.vars = y_cols,
variable.name = "time",
value.name = "glucose")
fd_long[, time:=factor(time, y_cols)]
fit <- gls(glucose ~ factor(time)*treatment,
data = fd_long,
weights = varIdent(form= ~ 1 | time),
correlation= corSymm(form=~ 1| id)
)
Sigma_fit <- getVarCov(fit, individual=fd_long[1,id])
Rho_fit <- cov2cor(Sigma_fit)
Rho_fit
beta
n <- 10^4
# using path model
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0.5 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
# using rmvnorm
R <- diag(2)
R[2,1] <- R[1, 2] <- rho
sigma <- c(sigma_pre, sigma_post)
Sigma <- diag(sigma)%*%R%*%diag(sigma)
beta_1_vec <- c(0, beta_1)
gtt_effects <- c(alpha_1, alpha_1 + tau)
beta <- gtt_effects*sigma + alpha_1*beta_1_vec
y_cols <- c("pre", "post")
mu <- c(10, 10)
names(mu) <- y_cols
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
fd <- data.table(treatment=treatment, each=n)
fd[, id:=factor(1:.N)]
fd_wide <- cbind(fd, Y)
coef(lm(post ~ pre + treatment, data=fd_wide))
fd_long <- melt(fd_wide, id.vars=c("treatment", "id"),
measure.vars = y_cols,
variable.name = "time",
value.name = "glucose")
fd_long[, time:=factor(time, y_cols)]
fit <- gls(glucose ~ factor(time)*treatment,
data = fd_long,
weights = varIdent(form= ~ 1 | time),
correlation= corSymm(form=~ 1| id)
)
Sigma_fit <- getVarCov(fit, individual=fd_long[1,id])
Rho_fit <- cov2cor(Sigma_fit)
Rho_fit
fd_wide[, .(pre=mean(pre), post=mean(post)), by=treatment]
n <- 10^4
# using path model
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0.5 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
# using rmvnorm
R <- diag(2)
R[2,1] <- R[1, 2] <- rho
sigma <- c(sigma_pre, sigma_post)
Sigma <- diag(sigma)%*%R%*%diag(sigma)
beta_1_vec <- c(0, beta_1)
gtt_effects <- c(alpha_1, alpha_1 + tau)
beta <- gtt_effects*sigma + alpha_1*beta_1_vec
y_cols <- c("pre", "post")
mu <- c(10, 10)
names(mu) <- y_cols
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
fd <- data.table(treatment=treatment, each=n)
fd[, id:=factor(1:.N)]
fd_wide <- cbind(fd, Y)
coef(lm(post ~ pre + treatment, data=fd_wide))
fd_wide[, .(pre=mean(pre), post=mean(post)), by=treatment]
fd_long <- melt(fd_wide, id.vars=c("treatment", "id"),
measure.vars = y_cols,
variable.name = "time",
value.name = "glucose")
fd_long[, time:=factor(time, y_cols)]
fit <- gls(glucose ~ factor(time)*treatment,
data = fd_long,
weights = varIdent(form= ~ 1 | time),
correlation= corSymm(form=~ 1| id)
)
Sigma_fit <- getVarCov(fit, individual=fd_long[1,id])
Rho_fit <- cov2cor(Sigma_fit)
Rho_fit
n <- 10^4
# using path model
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.6
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0.5 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
# using rmvnorm
R <- diag(2)
R[2,1] <- R[1, 2] <- rho
sigma <- c(sigma_pre, sigma_post)
Sigma <- diag(sigma)%*%R%*%diag(sigma)
beta_1_vec <- c(0, beta_1)
gtt_effects <- c(alpha_1, alpha_1 + tau)
beta <- gtt_effects + alpha_1*beta_1_vec
y_cols <- c("pre", "post")
mu <- c(10, 10)
names(mu) <- y_cols
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
fd <- data.table(treatment=treatment, each=n)
fd[, id:=factor(1:.N)]
fd_wide <- cbind(fd, Y)
coef(lm(post ~ pre + treatment, data=fd_wide))
fd_wide[, .(pre=mean(pre), post=mean(post)), by=treatment]
fd_long <- melt(fd_wide, id.vars=c("treatment", "id"),
measure.vars = y_cols,
variable.name = "time",
value.name = "glucose")
fd_long[, time:=factor(time, y_cols)]
fit <- gls(glucose ~ factor(time)*treatment,
data = fd_long,
weights = varIdent(form= ~ 1 | time),
correlation= corSymm(form=~ 1| id)
)
Sigma_fit <- getVarCov(fit, individual=fd_long[1,id])
Rho_fit <- cov2cor(Sigma_fit)
Rho_fit
n <- 10^4
# using path model
alpha_1 <- 0.5 # treatment effect at baseline
treatment <- rep(c("cn", "tr"), each=n)
X <- model.matrix(~treatment)
treatmenttr <- X[, "treatmenttr"]
alpha <- c(10, alpha_1)
sigma_pre <- 2
pre <- X%*%alpha + rnorm(n*2, mean=0, sd=sigma_pre)
rho <- 0.0
sigma_post <- 3
beta_1 <- rho*sigma_post/sigma_pre
tau <- 0.5 # treatment
post <- beta_1*pre + (alpha_1 + tau)*treatmenttr + sqrt(sigma_post^2 - (beta_1*sigma_pre)^2)*rnorm(n*2)
sd(pre)
sd(post)
cor(pre, post)
coef(lm(post ~ pre + treatment))
# using rmvnorm
R <- diag(2)
R[2,1] <- R[1, 2] <- rho
sigma <- c(sigma_pre, sigma_post)
Sigma <- diag(sigma)%*%R%*%diag(sigma)
beta_1_vec <- c(0, beta_1)
gtt_effects <- c(alpha_1, alpha_1 + tau)
beta <- gtt_effects + alpha_1*beta_1_vec
y_cols <- c("pre", "post")
mu <- c(10, 10)
names(mu) <- y_cols
Y <- rbind(rmvnorm(n, mu, Sigma),
rmvnorm(n, mu+beta, Sigma))
fd <- data.table(treatment=treatment, each=n)
fd[, id:=factor(1:.N)]
fd_wide <- cbind(fd, Y)
coef(lm(post ~ pre + treatment, data=fd_wide))
fd_wide[, .(pre=mean(pre), post=mean(post)), by=treatment]
fd_long <- melt(fd_wide, id.vars=c("treatment", "id"),
measure.vars = y_cols,
variable.name = "time",
value.name = "glucose")
fd_long[, time:=factor(time, y_cols)]
fit <- gls(glucose ~ factor(time)*treatment,
data = fd_long,
weights = varIdent(form= ~ 1 | time),
correlation= corSymm(form=~ 1| id)
)
Sigma_fit <- getVarCov(fit, individual=fd_long[1,id])
Rho_fit <- cov2cor(Sigma_fit)
Rho_fit
beta_1_vec
